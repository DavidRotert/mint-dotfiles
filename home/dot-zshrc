source_if_exists() {
    if [ -f "$1" ]
    then
        source "$1"
    fi
}

# ZSH built in autocomplete
autoload -Uz compinit
compinit

zstyle ':completion:*' menu select

# Autocorrection
## Fix autocorrection
alias cp='nocorrect cp'
alias ebuild='nocorrect ebuild'
alias gist='nocorrect gist'
alias heroku='nocorrect heroku'
alias hpodder='nocorrect hpodder'
alias man='nocorrect man'
alias mkdir='nocorrect mkdir'
alias mv='nocorrect mv'
alias mysql='nocorrect mysql'
alias sudo='nocorrect sudo'

setopt correct_all

# History configuration
HISTFILE="$HOME/.zsh_history"
HISTSIZE=10000
SAVEHIST=10000

## History command configuration
setopt hist_expire_dups_first # delete duplicates first when HISTFILE size exceeds HISTSIZE
setopt hist_ignore_dups # ignore duplicated commands history list
setopt hist_save_no_dups
#setopt hist_ignore_space # ignore commands that start with space
setopt hist_verify # show command with history expansion to user before running it
setopt share_history # share command history data
#setopt inc_append_history

clear-history() {
    echo "" > $HISTFILE
    history -p
}

# Directory config
## Changing/making/removing directory
setopt auto_pushd
setopt pushd_ignore_dups
setopt pushdminus

# Mode
bindkey -e

## Keybindings
bindkey "^[[H" beginning-of-line # home key
bindkey "^[[F" end-of-line # end key
bindkey "^[[1;5C" forward-word # ctrl + right arrow
bindkey "^[[1;5D" backward-word # ctrl + left arrow

## Edit line
autoload edit-command-line
zle -N edit-command-line
bindkey "^e" edit-command-line # ctrl + e

# Load plugins
local __plugins=(
    "/usr/share/zsh-autosuggestions/zsh-autosuggestions.zsh"
    "/usr/share/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh"
    "/usr/share/doc/fzf/examples/key-bindings.zsh"
)

local __plugin
for __plugin in $__plugins
do
    source_if_exists "$__plugin"
done

color_support=false
case "$TERM" in
    *-color|*-256color|xterm-kitty|xterm-ghostty)
        color_support=true
        ;;
esac

if [ "$color_support" = true ] && command -v oh-my-posh &>/dev/null 
then
    eval "$(oh-my-posh init zsh --config "$HOME/.config/oh-my-posh.yml")"
fi

if command -v zoxide &>/dev/null
then
    eval "$(zoxide init zsh)"
    alias cd="z"
fi

source_if_exists "$HOME/.zshrc_custom"

source_if_exists "$HOME/.aliases"
source_if_exists "$HOME/.aliases_custom"
